#### 3) Statement와 PreparedStatement (2)

Statement객체를 사용하면 SQL injection해킹에 노출될 수 있다.
만약 Statement객체를 이용하여 계좌번호 정보를 검색하는 코드를 짰다고 해보자.

![[media/file 1/DBUtill.java]]

DBUtil은 연결을 편하게 하기 위해 따로 만들어두었다.
```
conn = DBUtill.getConnection();
String sql = "select * from bankinfo where bank_no = '" + bankNo+"'";
stmt = conn.createStatement();
rs = stmt.executeQuery(sql);
```
bankNo에 원하는 계좌번호를 넣으면 그 계좌번호의 정보를 얻을 수 있겠지만...
bankNo자리에 ' or 1=1 --를 넣게 된다면, 
DB에서 사용되는 SQL문이 이렇게 변한다.
```
Select * from bankInfo where bank_no = '' or 1=1 --'
```
1=1은 언제나 참이고, 제일 뒤에 있는 작은 따옴표 하나는 주석처리가 되어 모든 계좌 정보가 출력되어버린다. 심지어 다른 테이블의 정보까지 꺼낼 수 있다.
```
Select * from bankInfo where bank_no = '' union select * from mem_id, mem_name, mem_pass, mem_add from member --'
```
을 해버리면 맨 뒤의 작은따옴표는 또 주석처리가 되어버리고 내가 이름을 아는 테이블의 이름을 아는 컬럼 정보를 모조리 긁어올 수 있게 된다.

이런걸 어떻게 막을 수 있을까?
PreparedStatement를 사용하면 된다.
PreparedStatement는 이미 쿼리문을 컴파일하여 준비해두고 ?자리에 값을 받기만 한다. ?자리 앞뒤를 따옴표로 알아서 감싸주기 때문에, ?자리에 따옴표가 들어오면 그 따옴표도 문자열로 만들어버린다. 그래서 이런 식으로는 뚫을 수 없다.

#### 4) CRUD 연습

초급프로젝트에서는..
왜 돼...
왜 안 돼...
를 반복하면서 했지만
이제는 DB연결하는 방법도 알고 CRUD 기능도 한시간만에 구현할 수 있게 되었다. 마지막교시에 CRUD를 작성하였다. 첨부한다.

![[media/file 1/JdbcTest07.java]]
