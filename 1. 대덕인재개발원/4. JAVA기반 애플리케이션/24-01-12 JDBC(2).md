#### 3) Statement와 PreparedStatement (2)

Statement객체를 사용하면 SQL injection해킹에 노출될 수 있다.
만약 Statement객체를 이용하여 계좌번호 정보를 검색하는 코드를 짰다고 해보자.

![[media/file 1/DBUtill.java]]

DBUtil은 연결을 편하게 하기 위해 따로 만들어두었다.
```
conn = DBUtill.getConnection();
String sql = "select * from bankinfo where bank_no = '" + bankNo+"'";
stmt = conn.createStatement();
rs = stmt.executeQuery(sql);
```
bankNo에 원하는 계좌번호를 넣으면 그 계좌번호의 정보를 얻을 수 있겠지만...
bankNo자리에 ' or 1=1 --를 넣게 된다면, 
DB에서 사용되는 SQL문이 이렇게 변한다.
```
Select * from bankInfo where bank_no = '' or 1=1 --'
```
1=1은 언제나 참이고, 제일 뒤에 있는 작은 따옴표 하나는 주석처리가 되어 모든 계좌 정보가 출력되어버린다. 심지어 다른 테이블의 정보까지 꺼낼 수 있다.
```
Select * from bankInfo where bank_no = '' union select * from mem_id, mem_name, mem_pass, mem_add from member --'
```
을 해버리면 맨 뒤의 작은따옴표는 또 주석처리가 되어버리고 내가 이름을 아는 테이블의 이름을 아는 컬럼 정보를 모조리 긁어올 수 있게 된다.

이런걸 어떻게 막을 수 있을까?
PreparedStatement를 사용하면 된다.
PreparedStatement는 이미 쿼리문을 컴파일하여 준비해두고 ?자리에 값을 받기만 한다. ?자리 앞뒤를 따옴표로 알아서 감싸주기 때문에, ?자리에 따옴표가 들어오면 그 따옴표도 문자열로 만들어버린다. 그래서 이런 식으로는 뚫을 수 없다.

#### 4) CRUD 연습

초급프로젝트에서는..
왜 돼...
왜 안 돼...
를 반복하면서 했지만
이제는 DB연결하는 방법도 알고 CRUD 기능도 한시간만에 구현할 수 있게 되었다. 마지막교시에 CRUD를 작성하였다. 첨부한다.

![[media/file 1/JdbcTest07.java]]


### 잠깐: 초기화 블럭이란?

자바에서 필드는 초기화하지 않아도 변수의 타입에 맞게 자동으로 초기화되지만, 지역변수와 마찬가지로 적절한 값으로 초기화한 후에 사용하는 것이 좋다. 

이렇게 필드를 초기화하는 방법은 이런 방법들이 있다.
1. 명시적 초기화
```
class Example{
	// 클래스 변수의 명시적 초기화
	static int a = 10;
	// 인스턴스 변수의 명시적 초기화
	int b = 20;
}
```

2. 생성자를 이용한 초기화
객체의 생성과 동시에 필드를 초기화하는 방법.
생성자를 이용한 초기화는 인스턴스를 생성할 때까지-생성자가 작동할 때까지 필드를 초기화할 수 없다.

3. 초기화 블럭(initialization)을 이용한 초기화
클래스 필드의 초기화만을 담당하는 중괄호{}로 둘러싸인 블록을 말한다. 초기화 블럭 또한 인스턴스 초기화 블럭과 클래스 초기화 블럭으로 나뉜다.

인스턴스 초기화 블럭
```
{
	//여기에 초기화 내용을 적는다.
}
```
생성자와 마찬가지로 인스턴스가 생성될 때마다 실행된다.
하지만 언제나 생성자보다 먼저 실행된다.

생성자와 큰 차이가 없으므로 잘 쓰이진 않지만, 여러 개의 생성자가 있으면 모든 생성자에서 공통으로 수행되어야 할 코드를 인스턴스 초기화 블럭에 포함시켜 코드의 중복을 줄일 수 있다.

클래스 초기화 블록
```
static{
	//여기에 초기화 내용을 적는다.
}
```
클래스 초기화 블럭은 클래스가 처음으로 메모리에 로딩될 때 단 한번만 실행된다.
생성자나 인스턴스 초기화 블록으로는 수행할 수 없는 클래스 변수의 초기화를 수행할 때 사용된다.


변수의 초기화는 1. 선언, 2. 명시적 초기화, 3. 블럭 초기호, 생성자 순으로 실행된다.
클래스로딩 ==> static변수 생성 ==> static 변수가 기본값으로 초기화
==> static 변수의 명시적 초기화 ==> static초기화 블럭 실행 

객체 생성시
==> 인스턴스변수 생성 ==> 인스턴스변수의 기본값 초기화
==> 인스턴스변수의 명시적 초기화 ==> 인스턴스 초기화 블럭 실행
==> 생성자 실행